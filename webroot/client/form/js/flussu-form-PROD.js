/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
Flussu Client Script v4.1 - Compatible with Flussu Server v4.5 - Copyright (C) 2021-2025 Mille Isole SRL - Palermo (Italy)
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
window.mobileCheck=function(){let check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true;})(navigator.userAgent||navigator.vendor||window.opera);return check;};
const FC={v:"4.1",sv:"4.5",isMb:window.mobileCheck(),c:{srv:location.protocol+"//"+window.location.host+"/",api:null,nSrv:null,nTm:5000,isFr:false,anm:true,snd:false,dTit:true},s:{wid:null,sid:null,bid:null,lng:"IT",isIn:false,eS:null,cStp:0,tStp:0,stDt:null},u:{cnt:null,env:null,stA:null,ttl:null,prg:null,ntf:null}};
FC.c.api=FC.c.srv+"api/v2.0/";FC.c.nSrv=FC.c.srv+"notify";
const gUp=(n)=>{const r=new RegExp('[\?&]'+n+'=([^&#]*)').exec(window.location.href);return r?decodeURI(r[1]):null;};
document.addEventListener('DOMContentLoaded',function(){FC.s.sid=gUp('SID');FC.s.bid=gUp('BID');FC.s.lng=gUp('lang')||FC.s.lng;bInt();if(FC.s.wid&&!FC.s.isIn){setTimeout(()=>{iWF();},100);}});
function bInt(){const c=document.getElementById('flussu-form');if(!c)return;const h=`<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"><link href="${FC.c.srv}client/form/css/flussu-form.css" rel="stylesheet"><link rel="icon" href="${FC.c.srv}client/assets/img/favicon.png"><script>if(!CSS.escape){CSS.escape=function(v){return v.replace(/^(\d)/,'\\\\3$1 ');};}(function(){const s=localStorage.getItem('flussuDarkMode');const d=s?s==='true':window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;if(d){document.body.classList.add('dark-mode');}})();<\/script><div id="flussu-app" class="flussu-app"><header class="flussu-header" ${!FC.c.dTit?'style="display:none;"':''}><div class="flussu-header-content"><button id="flussu-menu" class="flussu-menu-btn" aria-label="Menu"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button><h1 id="flussuTitle" class="flussu-title">Loading...</h1></div><div id="flussuProgress" class="flussu-progress"><div class="flussu-progress-bar"></div></div></header><aside id="flussu-sidebar" class="flussu-sidebar"><div class="flussu-sidebar-content"><button class="flussu-sidebar-close" onclick="FC.u.sb.classList.remove('open')"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button><nav class="flussu-nav"><div class="flussu-nav-section"><div id="flussu-language-buttons" class="flussu-language-buttons"></div></div><div class="flussu-nav-section"><button class="flussu-nav-item" onclick="window.rWF()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg><span>Reset</span></button></div><div class="flussu-nav-section"><div class="flussu-nav-item"><span>Dark Mode</span><label class="flussu-switch"><input type="checkbox" id="darkModeToggle" onchange="window.tDM()"><span class="flussu-switch-slider"></span></label></div></div></nav></div></aside><main class="flussu-main"><div class="flussu-content"><div id="flussu-startarea" class="flussu-start-area"></div><div id="flussu-environment" class="flussu-environment" style="display:none;"></div></div></main><div id="flussuNotifyAlert" class="flussu-notify"></div><div id="flussu-loading" class="flussu-loading"><div class="flussu-spinner"></div></div></div><div id="flussu-lightbox" class="flussu-lightbox" onclick="cLB()"><img id="flussu-lightbox-img" src="" alt=""></div>`;c.innerHTML=h;FC.u={cnt:document.getElementById('flussu-app'),env:document.getElementById('flussu-environment'),stA:document.getElementById('flussu-startarea'),ttl:document.getElementById('flussuTitle'),prg:document.getElementById('flussuProgress'),ntf:document.getElementById('flussuNotifyAlert'),ld:document.getElementById('flussu-loading'),sb:document.getElementById('flussu-sidebar')};iEvL();}
function iEvL(){const m=document.getElementById('flussu-menu');if(m){m.addEventListener('click',()=>{FC.u.sb.classList.toggle('open');});}lDMP();document.addEventListener('keydown',hKP);document.addEventListener('click',function(e){if(e.target.matches('.flussu-image')){oLB(e.target.src);}});if(window.matchMedia){window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',(e)=>{if(localStorage.getItem('flussuDarkMode')===null){const d=e.matches;document.getElementById('darkModeToggle').checked=d;document.body.classList.toggle('dark-mode',d);}});}}
function hKP(e){if(e.key==='Enter'&&!e.target.matches('textarea')){e.preventDefault();const b=document.querySelector('.flussu-btn-primary');if(b)b.click();}}
async function iWF(){FC.s.isIn=true;sL();const sS=gSes();if(sS&&sS.wid===FC.s.wid){FC.s={...FC.s,...sS};await exWF();}else{await gWFI();}}
async function gWFI(){try{const r=await fetch(FC.c.api+'flussueng.php',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:new URLSearchParams({WID:FC.s.wid,CMD:'info'})});const d=await r.json();if(FC.c.dTit&&d.tit){FC.u.ttl.textContent=d.tit;}if(d.langs){const l=d.langs.split(',');sessionStorage.setItem('flussuLangs',d.langs);uLB(l);}if(FC.s.sid){await exWF();}else{sLS(d.langs.split(','));}}catch(e){sE('Connection error. Please try again.');}finally{hL();}}
function uLB(l){const c=document.getElementById('flussu-language-buttons');if(!c)return;let h='';const lN={'IT':'Italiano','EN':'English','FR':'Français','DE':'Deutsch','ES':'Español'};const fC={'IT':'it','EN':'gb','FR':'fr','DE':'de','ES':'es'};l.forEach(lg=>{const a=lg===FC.s.lng;const f=fC[lg]||lg.toLowerCase();h+=`<button class="flussu-lang-nav-btn ${a?'active':''}" onclick="window.cL('${lg}')" ${a?'disabled':''}><img src="https://flagcdn.com/24x18/${f}.png" alt="${lg}" class="flussu-flag-small"><span>${lN[lg]||lg}</span></button>`;});c.innerHTML=h;}
window.cL=async function(l){if(l===FC.s.lng)return;FC.s.lng=l;FC.u.sb.classList.remove('open');await exWF();};
window.rWF=async function(){FC.s.sid='';FC.s.bid='';cSes();FC.u.sb.classList.remove('open');await iWF();};
window.tDM=function(){const d=document.getElementById('darkModeToggle').checked;document.body.classList.toggle('dark-mode',d);localStorage.setItem('flussuDarkMode',d?'true':'false');localStorage.setItem('flussuDarkModeExplicit','true');setTimeout(()=>{FC.u.sb.classList.remove('open');},300);};
function lDMP(){const s=localStorage.getItem('flussuDarkMode');let d;if(s!==null){d=s==='true';}else{d=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;}document.getElementById('darkModeToggle').checked=d;document.body.classList.toggle('dark-mode',d);}
function sLS(l){let h='<div class="flussu-language-select"><h2 class="text-2xl font-bold mb-6 text-center">Select Language</h2><div class="flussu-lang-grid">';const lN={'IT':'Italiano','EN':'English','FR':'Français','DE':'Deutsch','ES':'Español'};const fC={'IT':'it','EN':'gb','FR':'fr','DE':'de','ES':'es'};l.forEach(lg=>{const f=fC[lg]||lg.toLowerCase();h+=`<button class="flussu-lang-btn" onclick="window.sWL('${lg}')"><img src="https://flagcdn.com/48x36/${f}.png" alt="${lg}" class="flussu-flag"><span>${lN[lg]||lg}</span></button>`;});h+='</div></div>';FC.u.stA.innerHTML=h;FC.u.stA.style.display='block';FC.u.env.style.display='none';}
window.sWL=async function(l){FC.s.lng=l;await exWF();};
async function exWF(){sL();const p=new URLSearchParams();p.append('WID',FC.s.wid);p.append('SID',FC.s.sid||'');p.append('BID',FC.s.bid||'');p.append('LNG',FC.s.lng);p.append('APP','WEB');if(FC.s.terms){p.append('TRM',FC.s.terms);}else if(FC.s.stDt&&!FC.s.sid){p.append('TRM',FC.s.stDt);FC.s.stDt=null;}else{p.append('TRM','');}try{const r=await fetch(FC.c.api+'flussueng.php',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded','Accept':'application/json'},body:p});const rt=await r.text();if(!r.ok){let em=`HTTP error! status: ${r.status}`;try{const ed=JSON.parse(rt);if(ed.error){em=ed.error;}}catch(e){if(rt){em+=' - '+rt;}}throw new Error(em);}let d;try{d=JSON.parse(rt);}catch(e){throw new Error('Invalid response from server');}pWR(d);}catch(e){sE('Error: '+e.message);}finally{hL();}}
function pWR(d){if(d[""]&&Array.isArray(d[""])&&d[""].includes("finiu")&&d[""].includes("stop")){sTS();return;}if(d.error){if(d.error.includes('E89')){cSes();sE('Session expired. Please start again.');setTimeout(()=>location.reload(),3000);}else{sE(d.error);}return;}if(!d.sid){cSes();iWF();return;}FC.s.sid=d.sid;FC.s.bid=d.bid;sSes();if(FC.s.wid){const sL=sessionStorage.getItem('flussuLangs');if(sL){uLB(sL.split(','));}}FC.s.terms='';rElm(d.elms);}
function sTS(){FC.u.stA.style.display='none';FC.u.env.style.display='flex';FC.u.env.innerHTML='<div class="flussu-thank-you"><h1 class="flussu-thank-you-text">GRAZIE</h1></div>';cSes();}
function iSSE(sId){FC.s.eS=new EventSource(FC.c.nSrv+'?SID='+sId);FC.s.eS.onmessage=function(e){hNot(e.data);};FC.s.eS.onerror=function(e){};}
function rElm(e){FC.u.stA.style.display='none';FC.u.env.style.display='block';let h='<div class="flussu-form-wrapper"><div class="flussu-block">';let bG=[];let hOBG=false;for(const[k,v]of Object.entries(e)){const[t,i]=k.split('$');const el={type:t,id:i,value:Array.isArray(v)?v:[v],key:k};if(t==='ITB'){bG.push(el);hOBG=true;}else{if(bG.length>0){h+='<div class="flussu-button-group">';bG.forEach(b=>{h+=rEl(b);});h+='</div>';bG=[];hOBG=false;}h+=rEl(el);}}if(bG.length>0){h+='<div class="flussu-button-group">';bG.forEach(b=>{h+=rEl(b);});h+='</div>';}h+='</div></div>';FC.u.env.innerHTML=h;setTimeout(()=>{const ta=document.querySelectorAll('.flussu-textarea-auto');ta.forEach(t=>{const aR=()=>{t.style.height='auto';const sH=t.scrollHeight;const mH=parseInt(window.getComputedStyle(t).minHeight);const xH=parseInt(window.getComputedStyle(t).maxHeight);if(sH>xH){t.style.height=xH+'px';t.style.overflowY='auto';}else{t.style.height=Math.max(sH,mH)+'px';t.style.overflowY='hidden';}};t.addEventListener('input',aR);if(t.value){aR();}});const fI=document.querySelector('.flussu-input:not([readonly])');if(fI)fI.focus();},100);}
function rEl(e){const{type,id,value,key}=e;const[c,cd,dv]=value;const cs=typeof cd==='string'?cd:(cd?.class||'');switch(type){case'L':return rLbl(c,cs);case'ITT':return rTI(id,c,cd,dv);case'ITB':return rBtn(id,c,cd);case'ITS':return rSel(id,c,cd,dv);case'ITM':return rMU(id,c,cs);case'M':return rMed(c,cd);case'A':return rAnc(c,cd);case'GUI':return rUIR(id,c);default:return`<div class="flussu-unknown">[${type}: ${c}]</div>`;}}
function pSC(cS){if(!cS||typeof cS!=='string')return null;const m=cS.match(/^\[(\d+)>(\d+)\]$/);if(m){return{min:parseInt(m[1]),max:parseInt(m[2])};}return null;}
function rLbl(c,cs){const cC=c.replace(/<h1[^>]*>/gi,'<h2 class="flussu-block-title">').replace(/<\/h1>/gi,'</h2>');return`<div class="flussu-label ${cs}">${cC}</div>`;}
function rTI(id,p,cd,dv){let iT=false;let iM=false;if(cd){if(typeof cd==='string'){iT=cd.includes('textarea');iM=cd.includes('flxMand');}else if(cd.display_info){iT=cd.display_info.subtype==='textarea';iM=cd.display_info.mandatory===true;}}const v=dv&&dv.startsWith('[val]:')?dv.substring(6):'';const cs=typeof cd==='string'?cd:(cd?.class||'');if(iT){return`<div class="flussu-input-group"><textarea name="$${id}" placeholder="${p}" class="flussu-input flussu-textarea flussu-textarea-auto ${cs} ${FC.s.bid}" ${iM?'required':''} rows="3">${v}</textarea>${iM?'<span class="flussu-required">* required</span>':''}</div>`;}return`<div class="flussu-input-group"><input type="text" name="$${id}" placeholder="${p}" value="${v}" class="flussu-input ${cs} ${FC.s.bid}" ${iM?'required':''}/>${iM?'<span class="flussu-required">* required</span>':''}</div>`;}
function rBtn(id,t,cd){const cs=typeof cd==='string'?cd:(cd?.class||'');const iP=id==='0';let iSV=false;if(cd&&cd.display_info){if(typeof cd.display_info==='string'){try{const dI=JSON.parse(cd.display_info);iSV=dI.subtype==='skip-validation';}catch(e){}}else{iSV=cd.display_info.subtype==='skip-validation';}}return`<button class="flussu-btn ${iP?'flussu-btn-primary':'flussu-btn-secondary'} ${cs}" onclick="window.sbF('$ex!${id}','${t.replace(/'/g,"\\'")}',${iSV})">${t}</button>`;}
function rSel(id,oJ,cd,dv){const o=JSON.parse(oJ);const dI=cd?.display_info||{};const st=dI.subtype||'selection';const iM=dI.mandatory||false;const sV=dv&&dv.startsWith('[val]:')?JSON.parse(dv.substring(6)):[];const sI=pSC(cd?.class);let h='<div class="flussu-selection-group">';if(sI&&st==='multiple'){h+='<div class="flussu-scale-matrix"><div class="flussu-scale-row flussu-scale-header-row"><div class="flussu-scale-item-label"></div><div class="flussu-scale-item-options">';for(let i=sI.min;i<=sI.max;i++){h+=`<div class="flussu-scale-header-number">${i}</div>`;}h+='</div></div>';for(const[k,l]of Object.entries(o)){const[v]=k.split(',');h+='<div class="flussu-scale-row"><div class="flussu-scale-item-label">'+l+'</div><div class="flussu-scale-item-options">';for(let i=sI.min;i<=sI.max;i++){const iId=`${id}_${v}_${i}`;const iC=sV.includes(`${v}_${i}`)?'checked':'';h+=`<label class="flussu-scale-option" for="${iId}"><input type="radio" id="${iId}" name="$${id}_${v}" value='@SCALE["${v}","${i}"]' class="${FC.s.bid} flussu-scale-input" ${iC} ${iM?'data-required="true"':''}/><span class="flussu-scale-dot"></span></label>`;}h+='</div></div>';}h+='</div>';}else if(st==='selection'||st==='default'){h+=`<select name="$${id}" class="flussu-input flussu-select ${FC.s.bid}" ${iM?'required':''}>`;if(!iM){h+='<option value="">Scegli un\'opzione...</option>';}for(const[k,l]of Object.entries(o)){const[v,iD]=k.split(',');const s=sV.includes(v)||(sV.length===0&&iD==='1')?'selected':'';h+=`<option value='@OPT["${v}","${l}"]' ${s}>${l}</option>`;}h+='</select>';}else if(st==='exclusive'){const iT='radio';h+='<div class="flussu-options-grid">';for(const[k,l]of Object.entries(o)){const[v,iD]=k.split(',');const c=sV.includes(v)||(sV.length===0&&iD==='1')?'checked':'';const iId=`${id}_${v}`;h+=`<label class="flussu-option-card" for="${iId}"><input type="${iT}" id="${iId}" name="$${id}" value='@OPT["${v}","${l}"]' class="${FC.s.bid}" ${c} ${iM?'required':''}/><span class="flussu-option-content"><span class="flussu-option-check"></span><span class="flussu-option-label">${l}</span></span></label>`;}h+='</div>';}else if(st==='multiple'&&!sI){const iT='checkbox';h+='<div class="flussu-options-grid">';for(const[k,l]of Object.entries(o)){const[v,iD]=k.split(',');const c=sV.includes(v)||(sV.length===0&&iD==='1')?'checked':'';const iId=`${id}_${v}`;h+=`<label class="flussu-option-card" for="${iId}"><input type="${iT}" id="${iId}" name="$${id}" value='@OPT["${v}","${l}"]' class="${FC.s.bid}" ${c}/><span class="flussu-option-content"><span class="flussu-option-check"></span><span class="flussu-option-label">${l}</span></span></label>`;}h+='</div>';}if(iM){h+='<span class="flussu-required">* required</span>';}h+='</div>';return h;}
function rMU(id,t,cs){return`<div class="flussu-upload-group"><label class="flussu-upload-label" for="upload_${id}"><input type="file" id="upload_${id}" name="$${id}" class="flussu-upload-input ${FC.s.bid}" onchange="window.hFU(this,'${id}')" accept="image/*,application/pdf,.doc,.docx"/><div class="flussu-upload-area" id="drop_${id}" ondrop="window.hDr(event,'${id}')" ondragover="window.hDO(event)" ondragleave="window.hDL(event)"><svg class="flussu-upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg><span class="flussu-upload-text">${t||'Click to upload or drag and drop'}</span><span class="flussu-upload-hint">PNG, JPG, PDF up to 10MB</span></div></label><div id="preview_${id}" class="flussu-upload-preview"></div></div>`;}
window.hDO=function(e){e.preventDefault();e.currentTarget.classList.add('drag-over');};
window.hDL=function(e){e.preventDefault();e.currentTarget.classList.remove('drag-over');};
window.hDr=function(e,id){e.preventDefault();e.currentTarget.classList.remove('drag-over');const f=e.dataTransfer.files;if(f.length>0){const i=document.getElementById(`upload_${id}`);i.files=f;window.hFU(i,id);}};
function rMed(u,cd){if(!u||u.trim()==='')return'';const dT=cd?.display_info?.type||'image';if(dT==='image'){return`<div class="flussu-media-container"><img src="${u}" alt="Media" class="flussu-image" loading="lazy"/></div>`;}else if(u.includes('youtube.com')||u.includes('youtu.be')){const vId=eYTI(u);return`<div class="flussu-video-container"><iframe src="https://www.youtube.com/embed/${vId}" frameborder="0" allowfullscreen class="flussu-video"></iframe></div>`;}return'';}
function rAnc(c,cd){let[t,u]=c.includes('!|!')?c.split('!|!'):[c,c];if(!u.startsWith('http')){u='https://'+u;}const iB=cd?.display_info?.subtype==='button';if(iB){return`<a href="${u}" target="_blank" class="flussu-btn flussu-btn-link">${t}</a>`;}return`<a href="${u}" target="_blank" class="flussu-link">${t}</a>`;}
function rUIR(id,c){return`<div class="flussu-user-info"><p>${c||'The app needs your personal data.'}</p><input type="hidden" name="$${id}" id="userInfoData" value='{"consent":"none"}'/></div>`;}
window.sbF=async function(bN,bV,sV=false){if(!sV&&!vF()){return;}const fD=cFD();fD[bN]=bV;FC.s.terms=JSON.stringify(fD);const cB=document.querySelector('.flussu-block:has(.flussu-btn-primary)');if(cB){cB.classList.add('completed');}await exWF();};
function cFD(){const fD={};const eB=CSS.escape?CSS.escape(FC.s.bid):FC.s.bid.replace(/([^\w-])/g,'\\$1');const e=document.querySelectorAll(`.${eB}`);const pSN=new Set();e.forEach(el=>{const n=el.name;if(!n)return;if(el.classList.contains('flussu-scale-input')){const bN=n.split('_').slice(0,-1).join('_');if(!pSN.has(bN)&&el.checked){pSN.add(bN);const sV={};const sI=document.querySelectorAll(`input[name^="${bN}_"]:checked`);sI.forEach(si=>{const nP=si.name.split('_');const iV=nP[nP.length-1];const m=si.value.match(/@SCALE\["([^"]+)","(\d+)"\]/);if(m){sV[m[1]]=m[2];}});if(Object.keys(sV).length>0){fD[bN]=JSON.stringify(sV);}}}else if(el.type==='file'&&el.files.length>0){const f=el.files[0];fD[n+'_name']=f.name;fD[n+'_data']=el.dataset.fileData||'';}else if(el.type==='checkbox'){if(el.checked&&!el.classList.contains('flussu-scale-input')){if(!fD[n+'_array']){fD[n+'_array']=[];}const m=el.value.match(/@OPT\["([^"]+)","([^"]+)"\]/);if(m){fD[n+'_array'].push({code:m[1],label:m[2]});}}}else if(el.type==='radio'){if(el.checked&&!el.classList.contains('flussu-scale-input')){fD[n]=el.value;}}else if(el.value){fD[n]=el.value;}});Object.keys(fD).forEach(k=>{if(k.endsWith('_array')&&Array.isArray(fD[k])){const rK=k.replace('_array','');const v=[];fD[k].forEach(i=>{v.push(`"${i.code}"`,`"${i.label}"`);});if(v.length>0){fD[rK]='@OPT['+v.join(',')+']';}delete fD[k];}});return fD;}
function vF(){const eB=CSS.escape(FC.s.bid);const rF=document.querySelectorAll(`.${eB}[required]`);let iV=true;const sC=document.querySelectorAll('.flussu-scale-matrix');sC.forEach(c=>{const hRI=c.querySelector('.flussu-scale-input[data-required="true"]');if(hRI){const sR=c.querySelectorAll('.flussu-scale-row:not(.flussu-scale-header-row)');sR.forEach(r=>{const rI=r.querySelectorAll('input[type="radio"]');const iRC=Array.from(rI).some(i=>i.checked);if(!iRC){r.classList.add('error');iV=false;}else{r.classList.remove('error');}});const p=c.closest('.flussu-selection-group');if(!iV&&p){p.classList.add('error');}else if(p){p.classList.remove('error');}}});rF.forEach(f=>{if(f.classList.contains('flussu-scale-input')){return;}const p=f.closest('.flussu-input-group, .flussu-selection-group');if(f.type==='checkbox'||f.type==='radio'){const n=f.name;const c=document.querySelector(`input[name="${n}"]:checked`);if(!c){if(p)p.classList.add('error');iV=false;}else{if(p)p.classList.remove('error');}}else if(!f.value.trim()){if(p)p.classList.add('error');iV=false;}else{if(p)p.classList.remove('error');}});if(!iV){sN('Completa tutti i campi obbligatori','error');}return iV;}
window.hFU=async function(i,id){const f=i.files[0];if(!f)return;const p=document.getElementById(`preview_${id}`);const mS=10*1024*1024;if(f.size>mS){sN('File size must be less than 10MB','error');i.value='';return;}p.innerHTML='<div class="flussu-file-loading">Loading...</div>';const r=new FileReader();r.onload=function(e){const b64=e.target.result;i.dataset.fileData=b64;if(f.type.startsWith('image/')){p.innerHTML=`<div class="flussu-file-preview"><img src="${b64}" alt="${f.name}" style="max-width: 200px; max-height: 200px;"/><div class="flussu-file-info"><span class="flussu-file-name">${f.name}</span><span class="flussu-file-size">${(f.size/1024).toFixed(2)} KB</span></div><button type="button" class="flussu-file-remove" onclick="window.rF('${id}')">×</button></div>`;}else{p.innerHTML=`<div class="flussu-file-preview"><svg class="flussu-file-icon" width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg><div class="flussu-file-info"><span class="flussu-file-name">${f.name}</span><span class="flussu-file-size">${(f.size/1024).toFixed(2)} KB</span></div><button type="button" class="flussu-file-remove" onclick="window.rF('${id}')">×</button></div>`;}};r.onerror=function(){p.innerHTML='<div class="flussu-file-error">Error loading file</div>';};r.readAsDataURL(f);};
window.rF=function(id){const i=document.getElementById(`upload_${id}`);const p=document.getElementById(`preview_${id}`);i.value='';delete i.dataset.fileData;p.innerHTML='';};
function uPrg(){const c=document.querySelectorAll('.flussu-block.completed').length;const pr=(c/FC.s.tStp)*100;const pB=document.querySelector('.flussu-progress-bar');if(pB){pB.style.width=`${pr}%`;}}
function hNot(d){if(!d||d==='{}')return;try{const n=JSON.parse(d);for(const[k,nt]of Object.entries(n)){if(k==='SID')continue;const{type,name,value}=nt;switch(type){case 1:sN(value,'info');break;case 2:aCnt(name,value);break;case 3:uCnt(name,value);break;case 4:aCM(value);break;case 5:hCB(name,value);break;}}}catch(e){}}
function sN(m,t='info'){const n=FC.u.ntf;n.className=`flussu-notify flussu-notify-${t}`;n.innerHTML=m;n.classList.add('show');setTimeout(()=>{n.classList.remove('show');},FC.c.nTm);}
function sL(){if(FC.u.ld){FC.u.ld.classList.add('show');}}
function hL(){if(FC.u.ld){FC.u.ld.classList.remove('show');}}
function sE(m){sN(m,'error');}
function sSes(){const s={wid:FC.s.wid,sid:FC.s.sid,bid:FC.s.bid,lng:FC.s.lng};sessionStorage.setItem('flussuSession',JSON.stringify(s));}
function gSes(){const s=sessionStorage.getItem('flussuSession');return s?JSON.parse(s):null;}
function cSes(){sessionStorage.removeItem('flussuSession');if(FC.s.eS){FC.s.eS.close();FC.s.eS=null;}}
function oLB(s){const l=document.getElementById('flussu-lightbox');const i=document.getElementById('flussu-lightbox-img');if(l&&i){i.src=s;l.classList.add('show');}}
window.cLB=function(){const l=document.getElementById('flussu-lightbox');if(l){l.classList.remove('show');}};
function eYTI(u){const m=u.match(/[?&]v=([^&]+)/)||u.match(/youtu\.be\/([^?]+)/);return m?m[1]:'';}
function tTS(t){if(!FC.c.snd||!window.speechSynthesis)return;if(t==='{CANC}'){window.speechSynthesis.cancel();return;}const u=new SpeechSynthesisUtterance(t);u.lang=FC.s.lng==='IT'?'it-IT':'en-US';u.rate=1;u.pitch=1;u.volume=1;window.speechSynthesis.speak(u);}
window.FlussuIn=function(l){if(l)FC.s.lng=l;if(l!==""||FC.s.sid!==null){iWF();}};
window.setFlussuId=function(w,t,a={}){FC.s.wid=w;FC.c.dTit=!(t==="0"||t==="false"||t==="none");if(FC.c.dTit&&FC.u.ttl){FC.u.ttl.textContent=t;}a["$isForm"]=true;a["$clientVersion"]=FC.v;a["$_FD0508"]=window.location.href;const uP=new URLSearchParams(window.location.search);for(let[k,v]of uP){if(k.startsWith('£')){a[k.replace('£','$')]=v;}}FC.s.stDt=JSON.stringify({arbitrary:a});if(document.readyState!=='loading'&&!FC.s.isIn){setTimeout(()=>{iWF();},100);}};
window.setFlussuSound=function(e){FC.c.snd=e==='Y'||e==='yes';};
window.setFlussuEndpoint=function(e){FC.c.srv=e;FC.c.api=e+"api/v2.0/";FC.c.nSrv=e+"notify";};
window.setFlussuInIframe=function(){FC.c.isFr=true;};
window.setFlussuCssVersion=function(v){};
if(typeof jQuery!=='undefined'){jQuery.urlParam=function(n){return gUp(n);};}

 //---------------
 //    _{()}_    |
 //    --[]--    |
 //      ||      |
 //  AL  ||  DVS |
 //  \\__||__//  |
 //   \__||__/   |
 //      \/      |
 //   @INXIMKR   |
 //--------------- 